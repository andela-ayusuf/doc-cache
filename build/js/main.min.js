function docRoutes(e){e.route("/documents").post(userCtrl.middleware,docCtrl.createDoc).get(userCtrl.middleware,docCtrl.getAllDocs),e.route("/documents/:id").get(userCtrl.middleware,docCtrl.getDoc).put(userCtrl.middleware,docCtrl.editDoc)["delete"](userCtrl.middleware,docCtrl.deleteDoc),e.route("/users/:id/documents").get(userCtrl.middleware,docCtrl.getUserDocs)}function routes(e){userRoutes(e),docRoutes(e)}function userRoutes(e){e.route("/users/login").post(userCtrl.login),e.route("/users/logout").post(userCtrl.logout),e.route("/users").post(userCtrl.createUser).get(userCtrl.middleware,userCtrl.getAllUsers),e.route("/users/:id").get(userCtrl.middleware,userCtrl.getUser).put(userCtrl.middleware,userCtrl.editUser)["delete"](userCtrl.middleware,userCtrl.deleteUser)}var Document=require("../models/document.model");exports.createDoc=function(e,o){var t=new Document;t.ownerId=e.decoded._id,t.title=e.body.title,t.content=e.body.content,t.save(function(e){return t.title?t.content?e?11e3===e.code?o.status(403).send({success:!1,message:"Document Title Already Exists!"}):o.status(403).send(e):o.status(200).send({success:!0,message:"Document Created.",id:t._id}):o.status(403).send({success:!1,message:"Content Field Cannot Be Empty!"}):o.status(403).send({success:!1,message:"Please Enter A Document Title!"})})},exports.getAllDocs=function(e,o){Document.find({}).exec(function(e,t){e?o.send(e):t?o.json(t):o.status(404).send({success:!1,message:"Documents Not Found!"})})},exports.getUserDocs=function(e,o){Document.find({ownerId:e.params.id}).exec(function(e,t){e?o.send(e):t?o.json(t):o.status(404).send({success:!1,message:"Documents Not Found!"})})},exports.getDoc=function(e,o){Document.find({_id:e.params.id},function(e,t){e?o.send(e):o.json(t)})},exports.editDoc=function(e,o){Document.findByIdAndUpdate(e.params.id,e.body,function(e,t){return e?o.send(e):void o.send({success:!0,message:"Document Updated!"})})},exports.deleteDoc=function(e,o){Document.findById(e.params.id).remove(function(e,t){return e?o.send(e):void o.send({success:!0,message:"Document Deleted"})})};var jwt=require("jsonwebtoken"),User=require("../models/user.model"),config=require("../../config/config");exports.createUser=function(e,o){var t=new User;t.username=e.body.username,t.name={first:e.body.first,last:e.body.last},t.email=e.body.email,t.password=e.body.password,t.save(function(e){if(!(t.username&&t.email&&t.password))return o.status(401).send({success:!1,message:"Invalid Username or Email or Password!"});if(!t.name.first||!t.name.first)return o.status(401).send({success:!1,message:"Invalid Firstname or Lastname!"});if(e)return 11e3===e.code?o.status(401).send({success:!1,message:"Username Already Exists!"}):o.status(401).send(e);var s=jwt.sign(t,config.secret,{expiresIn:1440});o.status(200).send({success:!0,token:s,message:"Welcome "+t.username,id:t._id})})},exports.login=function(e,o){User.findOne({username:e.body.username}).select("username password").exec(function(t,s){if(t)throw t;if(!s)return o.status(401).send({success:!1,message:"Invalid Username or Password!"});var n=s.comparePassword(e.body.password);if(!n)return o.status(401).send({success:!1,message:"Invalid Username or Password!"});var r=jwt.sign(s,config.secret,{expiresIn:1440});o.json({success:!0,message:"Welcome "+s.username,token:r,id:s._id})})},exports.middleware=function(e,o,t){var s=e.body.token||e.query.token||e.headers["x-access-token"];return s?void jwt.verify(s,config.secret,function(s,n){return s?o.json({success:!1,message:"Failed to authenticate token."}):(e.decoded=n,void t())}):o.status(403).send({success:!1,message:"No token provided."})},exports.logout=function(e,o){e.session.destroy(function(e,t){e?o.send(e):o.send({success:!0,message:"You have logged out."})})},exports.getAllUsers=function(e,o){User.find({}).exec(function(e,t){e?o.send(e):t?o.json(t):o.status(404).send({success:!1,message:"Users not found!"})})},exports.getUser=function(e,o){User.findById(e.params.id,function(e,t){e?o.send(e):o.json(t)})},exports.editUser=function(e,o){User.findByIdAndUpdate(e.params.id,e.body,function(e,t){o.send({success:!0,message:"Account Updated!"})})},exports.deleteUser=function(e,o){User.findById(e.params.id).remove(function(e,t){return e?o.send(e):void o.send({success:!0,message:"Account Deleted"})})};var mongoose=require("mongoose"),Schema=mongoose.Schema,docSchema=new Schema({ownerId:{type:mongoose.Schema.Types.ObjectId,ref:"User"},title:{type:String,required:!0,unique:!0},content:{type:String,required:!0},dateCreated:{type:Date,"default":Date.now},lastModified:{type:Date,"default":Date.now}});module.exports=mongoose.model("Document",docSchema);var mongoose=require("mongoose"),Schema=mongoose.Schema,bcrypt=require("bcrypt-nodejs"),userSchema=new Schema({username:{type:String,required:!0,unique:!0},name:{first:{type:String,required:!0},last:{type:String,required:!0}},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0}});userSchema.pre("save",function(e){var o=this;return o.isModified("password")?void bcrypt.hash(o.password,null,null,function(t,s){return t?e(t):(o.password=s,void e())}):e()}),userSchema.methods.comparePassword=function(e){var o=this;return bcrypt.compareSync(e,o.password)},module.exports=mongoose.model("User",userSchema);var docCtrl=require("../controllers/document.controller"),userCtrl=require("../controllers/user.controller");module.exports=docRoutes;var userRoutes=require("./user.route"),docRoutes=require("./document.route");module.exports=routes;var userCtrl=require("../controllers/user.controller");module.exports=userRoutes,module.exports={secret:"karishika",port:process.env.PORT||5e3,database:"localhost:27017/apidb"};var config=require("./config"),mongoose=require("mongoose");mongoose.connect(config.database),mongoose.connection.on("connected",function(){console.log("Connection open to "+config.database)}),mongoose.connection.on("error",function(e){console.log("Connection error: "+e)}),mongoose.connection.on("disconnected",function(){console.log("Connection to "+config.database+" is closed")}),process.on("SIGINT",function(){mongoose.connection.close(function(){console.log("Connection closed through app termination"),process.exit(0)})});var express=require("express"),app=express(),router=express.Router(),mongoose=require("mongoose"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),morgan=require("morgan"),session=require("express-session"),methodOverride=require("method-override"),config=require("./config"),routes=require("../app/routes/"),db=require("./db"),path=require("path");routes(router),app.use(bodyParser.json()),app.use(morgan("dev")),app.use(session({saveUninitialized:!1,secret:"rosco",resave:!1})),app.use(bodyParser.json({type:"application/vnd.api+json"})),app.use(bodyParser.urlencoded({extended:!0})),app.use(express["static"](__dirname+"/../public")),app.use(function(e,o,t){o.header("Access-Control-Allow-Origin","*"),o.header("Access-Control-Allow-Headers","Origin, Accept, Content-Type, Access-Control-Allow-Headers, x_access_admin, Authorization, X-Requested-With"),o.header("Access-Control-Allow-Methods","POST, PUT, DELETE, GET"),t()}),app.get("/",function(e,o){o.sendFile(path.join(__dirname+"../public/index.html"))}),app.use(methodOverride("X-HTTP-Method-Override")),app.use(cookieParser()),app.use("/api",router),module.exports=app;var app=angular.module("dmsApp",["ui.router","ngStorage","ngMaterial","ngAria","ngResource","ngMdIcons"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(e,o,t,s){e.state("home",{url:"/",templateUrl:"app/views/home.view.html",controller:"HomeCtrl"}).state("login",{url:"/login",templateUrl:"app/views/login.view.html",controller:"UserCtrl"}).state("signup",{url:"/signup",templateUrl:"app/views/signup.view.html",controller:"UserCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"app/views/dashboard.view.html",controller:"DashboardCtrl"}).state("document",{url:"/document",templateUrl:"app/views/document.view.html",controller:"DocumentCtrl"}).state("profile",{url:"/profile",templateUrl:"app/views/profile.view.html",controller:"UserCtrl"}),o.otherwise("/"),t.interceptors.push(["$q","$location","$window",function(e,o,t){return{request:function(e){return e.headers=e.headers||{},t.sessionStorage.token&&(e.headers["x-access-token"]=t.sessionStorage.token),e},responseError:function(o){return 401===o.status||403===o.status?e.reject(o):void 0}}}])}]),angular.module("dmsApp").controller("DashboardCtrl",["$scope","$timeout",function(e,o){var t=this;t.isOpen=!1,e.$watch("demo.isOpen",function(s){s?o(function(){e.tooltipVisible=t.isOpen},600):e.tooltipVisible=t.isOpen}),t.items=[{name:"Profile",icon:"../assets/imgs/account.svg",href:"/#/profile"}]}]),angular.module("dmsApp").controller("DocumentCtrl",["DocumentService","ToastService","$window","$scope","$mdDialog","$location","$localStorage",function(e,o,t,s,n,r,i){function a(e,o){e.hide=function(){o.hide()},e.cancel=function(){o.cancel()}}s.createDoc=function(){e.createDoc(s.docs).then(function(e){location.reload(),o.showSimpleToast(e.data.message)},function(e){o.showSimpleToast("Please Fill The Required Fields!")})},s.getUserDocs=function(){var o=t.sessionStorage.userId;e.getUserDocs(o).then(function(e){s.userDocs=e.data},function(e){})},s.getDocId=function(){var e=t.sessionStorage.docId;return e},s.getDoc=function(o){t.sessionStorage.docId=o,e.getDoc(o).then(function(e){r.url("/document"),s.docs=e.data,console.log(s.docs)},function(e){})},s.editDoc=function(s){var n=t.sessionStorage.docId;e.editDoc(n,s).then(function(e){location.reload(),r.url("/dashboard"),o.showSimpleToast(e.data.message)},function(e){o.showSimpleToast("Please Fill The Required Fields!")})},s.editDocEv=function(e){n.show({controller:a,templateUrl:"app/views/editDoc.view.html",parent:angular.element(document.body),targetEvent:e})},s.deleteDocEv=function(e){n.show({controller:a,templateUrl:"app/views/deleteDoc.view.html",parent:angular.element(document.body),targetEvent:e})},s.deleteDoc=function(s){s=t.sessionStorage.docId,e.deleteDoc(s).then(function(e){location.reload(),r.url("/dashboard"),o.showSimpleToast(e.data.message)},function(e){})}}]),angular.module("dmsApp").controller("HomeCtrl",["$scope","$timeout",function(e,o){var t=this;t.isOpen=!1,e.$watch("demo.isOpen",function(s){s?o(function(){e.tooltipVisible=t.isOpen},600):e.tooltipVisible=t.isOpen}),t.items=[{name:"Signup",icon:"../assets/imgs/account-plus.svg",href:"/#/signup"},{name:"Login",icon:"../assets/imgs/login.svg",href:"/#/login"}]}]),angular.module("dmsApp").controller("UserCtrl",["$scope","$rootScope","UserService","ToastService","$location","$resource","$mdDialog","$window","$http",function(e,o,t,s,n,r,i,a,u){function c(e,o){e.hide=function(){o.hide()},e.cancel=function(){o.cancel()}}e.saveSessStorage=function(e,o){a.sessionStorage.token=o,a.sessionStorage.userId=e},e.signup=function(){t.createUser(e.user).then(function(o){e.saveSessStorage(o.data.id,o.data.token),e.userId=o.data.id,n.url("/dashboard"),s.showSimpleToast(o.data.message)},function(e){s.showSimpleToast(e.data.message)})},e.login=function(){t.login(e.user).then(function(o){e.saveSessStorage(o.data.id,o.data.token),n.url("/dashboard"),s.showSimpleToast(o.data.message)},function(e){s.showSimpleToast(e.data.message)})},e.logout=function(){a.sessionStorage.clear(),n.url("/home")},e.getUser=function(){var o=a.sessionStorage.userId;t.getUser(o).then(function(o){e.users=o.data},function(e){s.showSimpleToast(e.data.message)})},e.getUserId=function(){var e=a.sessionStorage.userId;return e},e.editUser=function(o){var n=a.sessionStorage.userId;t.editUser(n,o).then(function(o){e.user=o,location.reload(),s.showSimpleToast(o.data.message)},function(e){s.showSimpleToast(e.data.message)})},e.editUserEv=function(e){i.show({controller:c,templateUrl:"app/views/editProfile.view.html",parent:angular.element(document.body),targetEvent:e})},e.deleteUserEv=function(e){i.show({controller:c,templateUrl:"app/views/deleteProfile.view.html",parent:angular.element(document.body),targetEvent:e})},e.deleteUser=function(){var e=a.sessionStorage.userId;t.deleteUser(e).then(function(e){a.sessionStorage.clear(),n.url("/home")},function(e){s.showSimpleToast(e.data.message)})}}]),angular.module("dmsApp").value("baseUrl","http://localhost:5000"),angular.module("dmsApp").factory("DocumentService",["$http","baseUrl",function(e,o){var t={};return t.createDoc=function(t){return e.post(o+"/api/documents",t).then(function(e){return e})},t.getUserDocs=function(t){return e.get(o+"/api/users/"+t+"/documents").then(function(e){return e})},t.getDoc=function(t){return e.get(o+"/api/documents/"+t).then(function(e){return e})},t.editDoc=function(t,s){return e.put(o+"/api/documents/"+t,s).then(function(e){return e})},t.deleteDoc=function(t){return e["delete"](o+"/api/documents/"+t).then(function(e){return e})},t}]),angular.module("dmsApp").factory("ToastService",["$mdToast",function(e){var o={};return o.showSimpleToast=function(o){e.show(e.simple().content(o).position("right").hideDelay(3e3))},o}]),angular.module("dmsApp").factory("UserService",["$http","baseUrl",function(e,o){var t={};return t.createUser=function(t){return e.post(o+"/api/users",t).then(function(e){return e})},t.login=function(t){return e.post(o+"/api/users/login",t).then(function(e){return e})},t.getUser=function(t){return e.get(o+"/api/users/"+t).then(function(e){return e})},t.editUser=function(t,s){return e.put(o+"/api/users/"+t,s).then(function(e){return e})},t.deleteUser=function(t){return e["delete"](o+"/api/users/"+t).then(function(e){return e})},t}]);