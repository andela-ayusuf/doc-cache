function docRoutes(e){e.route("/documents").post(userCtrl.middleware,docCtrl.createDoc).get(userCtrl.middleware,docCtrl.getAllDocs),e.route("/documents/:id").get(userCtrl.middleware,docCtrl.getDoc).put(userCtrl.middleware,docCtrl.editDoc)["delete"](userCtrl.middleware,docCtrl.deleteDoc),e.route("/users/:id/documents").get(userCtrl.middleware,docCtrl.getUserDocs)}function routes(e){userRoutes(e),docRoutes(e)}function userRoutes(e){e.route("/users/login").post(userCtrl.login),e.route("/users/logout").post(userCtrl.logout),e.route("/users").post(userCtrl.createUser).get(userCtrl.middleware,userCtrl.getAllUsers),e.route("/users/:id").get(userCtrl.middleware,userCtrl.getUser).put(userCtrl.middleware,userCtrl.editUser)["delete"](userCtrl.middleware,userCtrl.deleteUser)}var Document=require("../models/document.model");exports.createDoc=function(e,t){var o=new Document;o.ownerId=e.decoded._id,o.title=e.body.title,o.content=e.body.content,o.save(function(e){return o.title?o.content?e?11e3===e.code?t.status(401).send({success:!1,message:"Document Title Already Exists!"}):t.status(401).send(e):t.status(200).send({success:!0,message:"Document Created.",id:o._id}):t.status(401).send({success:!1,message:"Content Field Cannot Be Empty!"}):t.status(401).send({success:!1,message:"Please Enter A Document Title!"})})},exports.getAllDocs=function(e,t){Document.find({}).exec(function(e,o){e?t.send(e):o?t.json(o):t.status(404).send({success:!1,message:"Documents Not Found!"})})},exports.getUserDocs=function(e,t){Document.find({ownerId:e.params.id}).exec(function(e,o){e?t.send(e):o?t.json(o):t.status(404).send({success:!1,message:"Documents Not Found!"})})},exports.getDoc=function(e,t){Document.find({_id:e.params.id},function(e,o){e?t.send(e):t.json(o)})},exports.editDoc=function(e,t){Document.findByIdAndUpdate(e.params.id,e.body,function(e,o){return e?t.send(e):void t.send({success:!0,message:"Document Updated!"})})},exports.deleteDoc=function(e,t){Document.findById(e.params.id).remove(function(e,o){return e?t.send(e):void t.send({success:!0,message:"Document Deleted"})})};var jwt=require("jsonwebtoken"),User=require("../models/user.model"),config=require("../../config/config");exports.createUser=function(e,t){var o=new User;o.username=e.body.username,o.name={first:e.body.first,last:e.body.last},o.email=e.body.email,o.password=e.body.password,o.save(function(e){if(!(o.username&&o.email&&o.password))return t.status(401).send({success:!1,message:"Invalid Username or Email or Password!"});if(!o.name.first||!o.name.first)return t.status(401).send({success:!1,message:"Invalid Firstname or Lastname!"});if(e)return 11e3===e.code?t.status(401).send({success:!1,message:"Username Already Exists!"}):t.status(401).send(e);var s=jwt.sign(o,config.secret,{expiresIn:1440});t.status(200).send({success:!0,token:s,message:"Welcome "+o.username,id:o._id})})},exports.login=function(e,t){User.findOne({username:e.body.username}).select("username password").exec(function(o,s){if(o)throw o;if(!s)return t.status(401).send({success:!1,message:"Invalid Username or Password!"});var n=s.comparePassword(e.body.password);if(!n)return t.status(401).send({success:!1,message:"Invalid Username or Password!"});var r=jwt.sign(s,config.secret,{expiresIn:1440});t.json({success:!0,message:"Welcome "+s.username,token:r,id:s._id})})},exports.middleware=function(e,t,o){var s=e.body.token||e.query.token||e.headers["x-access-token"];return s?void jwt.verify(s,config.secret,function(s,n){return s?t.json({success:!1,message:"Failed to authenticate token."}):(e.decoded=n,void o())}):t.status(403).send({success:!1,message:"Signup or Login."})},exports.logout=function(e,t){e.session.destroy(function(e,o){e?t.send(e):t.send({success:!0,message:"You have logged out."})})},exports.getAllUsers=function(e,t){User.find({}).exec(function(e,o){e?t.send(e):o?t.json(o):t.status(404).send({success:!1,message:"Users not found!"})})},exports.getUser=function(e,t){User.findById(e.params.id,function(e,o){e?t.send(e):t.json(o)})},exports.editUser=function(e,t){User.findByIdAndUpdate(e.params.id,e.body,function(e,o){t.send({success:!0,message:"Account Updated!"})})},exports.deleteUser=function(e,t){User.findById(e.params.id).remove(function(e,o){return e?t.send(e):void t.send({success:!0,message:"Account Deleted"})})};var mongoose=require("mongoose"),Schema=mongoose.Schema,docSchema=new Schema({ownerId:{type:mongoose.Schema.Types.ObjectId,ref:"User"},title:{type:String,required:!0,unique:!0},content:{type:String,required:!0},dateCreated:{type:Date,"default":Date.now},lastModified:{type:Date,"default":Date.now}});module.exports=mongoose.model("Document",docSchema);var mongoose=require("mongoose"),Schema=mongoose.Schema,bcrypt=require("bcrypt-nodejs"),userSchema=new Schema({username:{type:String,required:!0,unique:!0,trim:!0},name:{first:{type:String,required:!0,trim:!0},last:{type:String,required:!0,trim:!0}},email:{type:String,required:!0,unique:!0,trim:!0,match:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/},password:{type:String,required:!0,minlength:5}});userSchema.pre("save",function(e){var t=this;return t.isModified("password")?void bcrypt.hash(t.password,null,null,function(o,s){return o?e(o):(t.password=s,void e())}):e()}),userSchema.methods.comparePassword=function(e){var t=this;return bcrypt.compareSync(e,t.password)},module.exports=mongoose.model("User",userSchema);var docCtrl=require("../controllers/document.controller"),userCtrl=require("../controllers/user.controller");module.exports=docRoutes;var userRoutes=require("./user.route"),docRoutes=require("./document.route");module.exports=routes;var userCtrl=require("../controllers/user.controller");module.exports=userRoutes,module.exports={secret:"karishika",port:process.env.PORT||5e3,database:"localhost:27017/apidb"};var config=require("./config"),mongoose=require("mongoose");mongoose.connect(config.database),mongoose.connection.on("connected",function(){console.log("Connection open to "+config.database)}),mongoose.connection.on("error",function(e){console.log("Connection error: "+e)}),mongoose.connection.on("disconnected",function(){console.log("Connection to "+config.database+" is closed")}),process.on("SIGINT",function(){mongoose.connection.close(function(){console.log("Connection closed through app termination"),process.exit(0)})});var express=require("express"),app=express(),router=express.Router(),mongoose=require("mongoose"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),morgan=require("morgan"),session=require("express-session"),methodOverride=require("method-override"),config=require("./config"),routes=require("../app/routes/"),db=require("./db"),path=require("path");routes(router),app.use(bodyParser.json()),app.use(morgan("dev")),app.use(session({saveUninitialized:!1,secret:"rosco",resave:!1})),app.use(bodyParser.json({type:"application/vnd.api+json"})),app.use(bodyParser.urlencoded({extended:!0})),app.use(express["static"](__dirname+"/../public")),app.use(function(e,t,o){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, Accept, Content-Type, Access-Control-Allow-Headers, x_access_admin, Authorization, X-Requested-With"),t.header("Access-Control-Allow-Methods","POST, PUT, DELETE, GET"),o()}),app.get("/",function(e,t){t.sendFile(path.join(__dirname+"../public/index.html"))}),app.use(methodOverride("X-HTTP-Method-Override")),app.use(cookieParser()),app.use("/api",router),module.exports=app;var app=angular.module("dmsApp",["ui.router","ngStorage","ngMaterial","ngAria","ngResource","ngMdIcons"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(e,t,o,s){e.state("home",{url:"/",templateUrl:"app/views/home.view.html",controller:"HomeCtrl"}).state("login",{url:"/login",templateUrl:"app/views/login.view.html",controller:"UserCtrl"}).state("signup",{url:"/signup",templateUrl:"app/views/signup.view.html",controller:"UserCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"app/views/dashboard.view.html",controller:"DashboardCtrl"}).state("document",{url:"/document",templateUrl:"app/views/document.view.html",controller:"DocumentCtrl"}).state("profile",{url:"/profile",templateUrl:"app/views/profile.view.html",controller:"UserCtrl"}),t.otherwise("/"),o.interceptors.push(["$q","$location","$window",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.sessionStorage.token&&(e.headers["x-access-token"]=o.sessionStorage.token),e},responseError:function(o){return 403===o.status&&t.url("/home"),e.reject(o)}}}])}]),angular.module("dmsApp").controller("DashboardCtrl",["$scope","$timeout",function(e,t){var o=this;o.isOpen=!1,e.$watch("demo.isOpen",function(s){s?t(function(){e.tooltipVisible=o.isOpen},600):e.tooltipVisible=o.isOpen}),o.items=[{name:"Profile",icon:"../assets/imgs/account.svg",href:"/#/profile"}]}]),angular.module("dmsApp").controller("DocumentCtrl",["DocumentService","ToastService","$window","$scope","$mdDialog","$location","$localStorage",function(e,t,o,s,n,r,i){function a(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}s.createDoc=function(){e.createDoc(s.docs).then(function(e){location.reload(),t.showSimpleToast(e.data.message)},function(e){t.showSimpleToast("Please Fill The Required Fields!")})},s.getUserDocs=function(){var t=o.sessionStorage.userId;e.getUserDocs(t).then(function(e){s.userDocs=e.data},function(e){})},s.getDocId=function(){var e=o.sessionStorage.docId;return e},s.getDoc=function(t){o.sessionStorage.docId=t,e.getDoc(t).then(function(e){r.url("/document"),s.docs=e.data},function(e){})},s.editDoc=function(s){var n=o.sessionStorage.docId;e.editDoc(n,s).then(function(e){location.reload(),r.url("/document"),t.showSimpleToast(e.data.message)},function(e){t.showSimpleToast("Please Fill The Required Fields!")})},s.editDocEv=function(e){n.show({controller:a,templateUrl:"app/views/editDoc.view.html",parent:angular.element(document.body),targetEvent:e})},s.deleteDocEv=function(e){n.show({controller:a,templateUrl:"app/views/deleteDoc.view.html",parent:angular.element(document.body),targetEvent:e})},s.deleteDoc=function(s){s=o.sessionStorage.docId,e.deleteDoc(s).then(function(e){location.reload(),r.url("/dashboard"),t.showSimpleToast(e.data.message)},function(e){})}}]),angular.module("dmsApp").controller("HomeCtrl",["$scope","$timeout",function(e,t){var o=this;o.isOpen=!1,e.$watch("demo.isOpen",function(s){s?t(function(){e.tooltipVisible=o.isOpen},600):e.tooltipVisible=o.isOpen}),o.items=[{name:"Signup",icon:"../assets/imgs/account-plus.svg",href:"/#/signup"},{name:"Login",icon:"../assets/imgs/login.svg",href:"/#/login"}]}]),angular.module("dmsApp").controller("UserCtrl",["$scope","$rootScope","UserService","ToastService","$location","$resource","$mdDialog","$window","$http",function(e,t,o,s,n,r,i,a,u){function c(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}e.saveSessStorage=function(e,t){a.sessionStorage.token=t,a.sessionStorage.userId=e},e.signup=function(){o.createUser(e.user).then(function(t){e.saveSessStorage(t.data.id,t.data.token),e.userId=t.data.id,n.url("/dashboard"),s.showSimpleToast(t.data.message)},function(e){"User validation failed"===e.data.message?s.showSimpleToast("Password must be Five characters or more!"):s.showSimpleToast(e.data.message)})},e.login=function(){o.login(e.user).then(function(t){e.saveSessStorage(t.data.id,t.data.token),n.url("/dashboard"),s.showSimpleToast(t.data.message)},function(e){s.showSimpleToast(e.data.message)})},e.logout=function(){a.sessionStorage.clear(),n.url("/home")},e.getUser=function(){var t=a.sessionStorage.userId;o.getUser(t).then(function(t){e.users=t.data},function(e){s.showSimpleToast(e.data.message)})},e.getUserId=function(){var e=a.sessionStorage.userId;return e},e.editUser=function(t){var n=a.sessionStorage.userId;o.editUser(n,t).then(function(t){e.user=t,location.reload(),s.showSimpleToast(t.data.message)},function(e){s.showSimpleToast(e.data.message)})},e.editUserEv=function(e){i.show({controller:c,templateUrl:"app/views/editProfile.view.html",parent:angular.element(document.body),targetEvent:e})},e.deleteUserEv=function(e){i.show({controller:c,templateUrl:"app/views/deleteProfile.view.html",parent:angular.element(document.body),targetEvent:e})},e.deleteUser=function(){var e=a.sessionStorage.userId;o.deleteUser(e).then(function(e){a.sessionStorage.clear(),n.url("/home")},function(e){s.showSimpleToast(e.data.message)})}}]),angular.module("dmsApp").value("baseUrl","http://localhost:5000"),angular.module("dmsApp").factory("DocumentService",["$http","baseUrl",function(e,t){var o={};return o.createDoc=function(o){return e.post(t+"/api/documents",o).then(function(e){return e})},o.getUserDocs=function(o){return e.get(t+"/api/users/"+o+"/documents").then(function(e){return e})},o.getDoc=function(o){return e.get(t+"/api/documents/"+o).then(function(e){return e})},o.editDoc=function(o,s){return e.put(t+"/api/documents/"+o,s).then(function(e){return e})},o.deleteDoc=function(o){return e["delete"](t+"/api/documents/"+o).then(function(e){return e})},o}]),angular.module("dmsApp").factory("ToastService",["$mdToast",function(e){var t={};return t.showSimpleToast=function(t){e.show(e.simple().content(t).position("right").hideDelay(3e3))},t}]),angular.module("dmsApp").factory("UserService",["$http","baseUrl",function(e,t){var o={};return o.createUser=function(o){return e.post(t+"/api/users",o).then(function(e){return e})},o.login=function(o){return e.post(t+"/api/users/login",o).then(function(e){return e})},o.getUser=function(o){return e.get(t+"/api/users/"+o).then(function(e){return e})},o.editUser=function(o,s){return e.put(t+"/api/users/"+o,s).then(function(e){return e})},o.deleteUser=function(o){return e["delete"](t+"/api/users/"+o).then(function(e){return e})},o}]);